# 세션 관리 가이드

## 개요

동고리 플랫폼의 세션 관리 정책은 보안과 사용자 경험(UX)의 균형을 고려하여 설계되었습니다.

## 세션 유지 시간 정책

### 1. 일반 사용자 (30일)
- **대상**: 이메일/비밀번호로 가입한 일반 사용자
- **기간**: 30일
- **근거**: 편의성 우선 (자주 로그인할 필요 없음)
- **적용 위치**: 
  - `app/api/auth/login/route.ts`
  - `app/sign-in/page.tsx` (일반 사용자 로그인)

### 2. 봉제공장 (14일)
- **대상**: 봉제공장 계정 (factory01, factory02 등)
- **기간**: 14일
- **근거**: 중간 수준의 보안 (비즈니스 계정이지만 자주 사용)
- **적용 위치**: 
  - `app/sign-in/page.tsx` (봉제공장 로그인)

### 3. 관리자 (1일)
- **대상**: 관리자 계정 (donggori2025)
- **기간**: 1일
- **근거**: 최고 수준의 보안 (관리자 권한 보호)
- **적용 위치**: 
  - `app/api/admin/login/route.ts`

### 4. 소셜 로그인 (30일)
- **대상**: 카카오, 네이버로 로그인한 사용자
- **기간**: 30일
- **근거**: 편의성 우선 (소셜 로그인의 장점 활용)
- **적용 위치**: 
  - `app/api/auth/sns/session/route.ts`
  - `app/api/auth/kakao/callback/route.ts`
  - `app/api/auth/naver/callback/route.ts`

## 보안 고려사항

### 1. 쿠키 보안 설정
- `httpOnly: true` - XSS 공격 방지
- `secure: true` (프로덕션) - HTTPS에서만 전송
- `sameSite: 'lax'` - CSRF 공격 방지

### 2. 세션 토큰
- JWT 기반 세션 토큰 사용
- 데이터베이스에 세션 정보 저장
- 만료 시간 자동 관리

### 3. 자동 로그아웃
- 세션 만료 시 자동 로그아웃
- 보안을 위한 세션 갱신 없음

## 사용자 경험 고려사항

### 1. 편의성
- 일반 사용자와 소셜 로그인: 30일 (편의성 우선)
- 봉제공장: 14일 (적당한 편의성)
- 관리자: 1일 (보안 우선)

### 2. 재로그인 유도
- 세션 만료 시 명확한 안내 메시지
- 로그인 페이지로 자동 리다이렉트

## 설정 변경 방법

### 1. 세션 시간 변경
`lib/sessionConfig.ts` 파일에서 `SESSION_DURATIONS` 상수 수정:

```typescript
export const SESSION_DURATIONS = {
  USER: 60 * 60 * 24 * 30,    // 30일
  FACTORY: 60 * 60 * 24 * 14, // 14일
  ADMIN: 60 * 60 * 24 * 1,    // 1일
  SOCIAL: 60 * 60 * 24 * 30,  // 30일
} as const;
```

### 2. 개별 설정 변경
특정 로그인 방식만 변경하려면 해당 파일에서 직접 수정:

```typescript
// 예: 봉제공장 세션을 7일로 변경
const factorySessionDuration = 60 * 60 * 24 * 7;
```

## 모니터링 및 로그

### 1. 세션 생성 로그
- 모든 세션 생성 시 로그 기록
- 사용자 타입별 세션 통계

### 2. 세션 만료 로그
- 세션 만료 시 로그 기록
- 보안 분석을 위한 데이터 수집

## 권장사항

### 1. 정기적인 검토
- 분기별로 세션 정책 검토
- 사용자 피드백 반영

### 2. 보안 강화
- 필요시 세션 시간 단축
- 추가 인증 단계 도입 고려

### 3. 사용자 안내
- 세션 정책에 대한 명확한 안내
- 로그아웃 기능의 쉬운 접근
